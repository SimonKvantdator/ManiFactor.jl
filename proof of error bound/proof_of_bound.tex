\documentclass[english, a4paper, 12pt]{article}
\input{preamble.tex}
\usepackage[]{mathrsfs} % For \mathscr
\usepackage{textcomp} % Mainly for using interrobang

\title{Proof of error bound on manifold given error bound on the tangent space}
\author{}
\date{\today}

\newcommand\bodgeip[2]{\langle #1, #2 \rangle} % BODGE

\begin{document}

\maketitle

\begin{theorem}\label{thm:error_bond_on_manifold}
	Let $M$ be a Riemannian manifold with sectional curvature bounded from below by $H$ and let $f \from R \to M$ where $R$ is a subset of $\reals^n$ such that its image fits in a single normal coordinate chart $S$ around $p \in M$, which fits inside some geodesic ball of radius $\sigma$.
	Define $g = \operatorname{log}_p \circ f \from R \to S$.
	Let $\mathhat{g} \from R \to S$ be an approximation of $g$ such that
	\begin{align}
		\abs{g(x) - \mathhat{g}(x)} \leq \epsilon
	\end{align}
	and define $\mathhat{f} = \operatorname{exp}_p \circ \mathhat{g}$.

	If $H > 0$ and $\sigma < \frac{\pi}{\sqrt{H}}$, then
	\begin{align}
		d_M(f, \mathhat{f}) \leq \epsilon.%
		\label{eq:positive_curvature_error_bound}
	\end{align}

	If $H < 0$, then
	\begin{align}
		d_M(f, \mathhat{f}) \leq{}& \epsilon + \frac{2}{\sqrt{\abs{H}}} \operatorname{arcsinh} \left(
			\frac{\epsilon}{2} \cdot \frac{\sinh{\sqrt{\abs{H}} \sigma}}{\sigma}
			\right).%
		\label{eq:negative_curvature_error_bound}
	\end{align}
\end{theorem}

In terms of elementary functions, \cref{eq:negative_curvature_error_bound} can in turn be upper bounded by
\begin{align}
	d_M(f, \mathhat{f}) \leq{}& \epsilon + \frac{2}{\sqrt{\abs{H}}} \log{ \left(
		\frac{\epsilon}{2} \cdot \frac{\exp{\sqrt{\abs{H}} \sigma} - 1}{\sigma} + 1
		\right)}.%
	\label{eq:negative_curvature_error_bound_with_elementary_functions}
\end{align}

Many manifolds have known sectional curvature.
Some examples of manifolds with sectional curvature bounded from below are
\begin{itemize}
	\item Compact Lie groups (and their products with $\reals^n$) like $\group{O}{n}$ and $\mathrm{G}_2$, where
	\begin{align}
		K(P, Q) = \frac{\norm{[P, Q]}_F^2}{4} \geq 0, 
	\end{align}
	(Cheeger 2008 corollary 3.19 + proposition 3.34).
	\item TODO.
\end{itemize}

\bigskip

Let's state some things that we need in the proof of \cref{thm:error_bond_on_manifold}.
\todo[inline]{How to deal with completeness?\dots}

\begin{theorem}[Toponogov]\label{thm:toponogov}
	Let $M$ be a complete Riemannian manifold with sectional curvature $K \geq H$.
	Let $\gamma_1$ and $\gamma_2$ be geodesics on $M$ such that $\gamma_1(0) = \gamma_2(0)$.
	If $H > 0$, assume $\abs{\gamma_1}$, $\abs{\gamma_2} \leq \frac{\pi}{\sqrt{H}}$.
	Let $\lambda_1$ and $\lambda_2$ be geodesics on a model manifold $N$ of constant curvature $H$ such that
	\begin{align}
		\lambda_1(0) ={}& \lambda_2(0),\\
		\abs{\lambda_1} ={}& \abs{\gamma_1},\\
		\abs{\lambda_2} ={}& \abs{\gamma_2},\\
		\angle(\lambda_1, \lambda_2) ={}& \angle(\gamma_1, \gamma_2).
	\end{align}
	Then
	\begin{align}
		d_{M}(\gamma_1(x), \gamma_2(y)) \leq d_{N}(\lambda_1(x), \lambda_2(y))
	\end{align}
	for all $x$, $y$.
\end{theorem}

\begin{lemma}[Spherical and hyperbolic law of cosines]\label{lemma:law_of_cosines}
	Let $N$ be a manifold of constant curvature $H$.
	Let $T$ be a geodesic triangle on $N$ with side lengths $A$, $B$, $C$ and angles $a$, $b$, $c$.
	Then
	\begin{align}
		\cos{C \sqrt{H}} ={}& \cos{A \sqrt{H}} \cos{B \sqrt{H}} + \sin{A \sqrt{H}} \sin{B \sqrt{H}} \cos{c}
	\end{align}
	if $H > 0$, and
	\begin{align}
		\cosh{C \sqrt{\abs{H}}} ={}& \cosh{A \sqrt{\abs{H}}} \cosh{B \sqrt{\abs{H}}} - \sinh{A \sqrt{\abs{H}}} \sinh{B \sqrt{\abs{H}}} \cos{c}
	\end{align}
	if $H < 0$.
\end{lemma}

\bigskip

\begin{proof}[proof of \cref{thm:error_bond_on_manifold}]
	Let $N$ be the manifold of constant curvature $H$ and let $q \in N$.
	Define $h = \operatorname{exp}_{N, q} \circ g$ and $\mathhat{h} = \operatorname{exp}_{N, q} \circ \mathhat{g}$.
	This is well-defined by requiring that $\abs{g}$, $\abs{\mathhat{g}} < \frac{\pi}{\sqrt{H}}$ when $H > 0$.
	By \cref{thm:toponogov}, we have that
	\begin{align}
		d_M(f(x), \mathhat{f}(y)) \leq d_N(h(x), \mathhat{h}(y)).
	\end{align}
	Now our task is to bound the right-hand side of this inequality when $x = y$.

	\paragraph{Case 1: $H > 0$.}
	Let $\cos'{t} = \cos{t \sqrt{H}}$ and $\sin'{t} = \sin{t \sqrt{H}}$ be reparametrized trigonometric functions and consider the geodesic triangle $(h(x), \mathhat{h}(x), q)$ on $N$.
	By \cref{lemma:law_of_cosines},
	\begin{align}
		\cos'{d(h, \mathhat{h})} ={}&
			\cos'{d(h, q)} \cos'{d(\mathhat{h}, q)}
			+ \sin'{d(h, q)} \sin'{d(\mathhat{h}, q)} \cos{\left\{ \angle(h, \mathhat{h}) \right\}}\\
		%
		={}&
			\cos'{\abs{g}} \cos'{\abs{\mathhat{g}}}
			+ \sin'{\abs{g}} \sin'{\abs{\mathhat{g}}} \cos{\left\{ \angle(g, \mathhat{g}) \right\}}.%
		\label{eq:exact_expression_for_cos_of_rhs}
	\end{align}
	Since $\abs{g}$, $\abs{\mathhat{g}} < \frac{\pi}{\sqrt{H}}$,
	\begin{align}
		\sin'{\abs{g}} \sin'{\abs{\mathhat{g}}} \geq 0.
	\end{align}
	Hence using
	\begin{align}
		\cos{\left\{ \angle(g, \mathhat{g}) \right\}} \leq 1
	\end{align}
	in \cref{eq:exact_expression_for_cos_of_rhs} gives us
	\begin{align}
		\cos'{d(h, \mathhat{h})} \geq{}&
			\cos'{\abs{g}} \cos'{\abs{\mathhat{g}}}
			+ \sin'{\abs{g}} \sin'{\abs{\mathhat{g}}}\\
		%
		={}& \cos{(\abs{g} - \abs{\mathhat{g}})}.
	\end{align}
	And so
	\begin{align}
		d(h, \mathhat{h}) \leq{}& \abs{\abs{g} - \abs{\mathhat{g}}}\\
		\leq{}& \abs{g - \mathhat{g}}
	\end{align}
	
	\paragraph{Case 2: $H < 0$.}
	Let $\cosh'{t} = \cosh{t \sqrt{\abs{H}}}$ and $\sinh'{t} = \sinh{t \sqrt{\abs{H}}}$ and consider again the geodesic triangle $(h(x), \mathhat{h}(x), q)$.
	Again, by \cref{lemma:law_of_cosines},
	\begin{align}
		\cosh'{d(h, \mathhat{h})} ={}&
		\cosh'{\abs{g}} \cosh'{\abs{\mathhat{g}}} - \sinh'{\abs{g}} \sinh'{\abs{\mathhat{g}}} \cos{\left\{ \angle(g, \mathhat{g}) \right\}}.%
		\label{eq:exact_expression_for_cosh_of_rhs}
		%
		% ={}& \frac{1}{2} \big[
		% 	\cosh'{(\abs{g} - \abs{\mathhat{g}})}
		% 	+ \cosh'{(\abs{g} + \abs{\mathhat{g}})}
		% \big]\\
		% &- \frac{1}{2} \big[
		% 	-\cosh'{(\abs{g} - \abs{\mathhat{g}})}
		% 	+ \cosh'{(\abs{g} + \abs{\mathhat{g}})}
		% \big] \cos{\left\{ \angle(g, \mathhat{g}) \right\}}.%
		% \label{eq:exact_expression_for_cosh_of_rhs}
	\end{align}
	Since $\sinh'{}$ is positive for positive arguments,
	\begin{align}
		\sinh'{\abs{g}} \sinh'{\abs{\mathhat{g}}} \geq 0.
	\end{align}
	Hence using
	\begin{align}
		% \cos{\left\{ \angle(g, \mathhat{g}) \right\}} \geq 1 - \frac{1}{2} \angle(g, \mathhat{g})^2 \geq 1 - \frac{\abs{g - \mathhat{g}}^2}{2 \abs{g}^2}.
		\cos{\left\{ \angle(g, \mathhat{g}) \right\}} ={}& \frac{\bodgeip{g}{\mathhat{g}}}{\abs{g} \abs{\mathhat{g}}}\\
		%
		={}& \frac{\abs{g}^2 + \abs{\mathhat{g}}^2}{2 \abs{g} \abs{\mathhat{g}}} - \frac{\abs{g - \mathhat{g}}^2}{2 \abs{g} \abs{\mathhat{g}}}\\
		%
		\geq{}& 1 - \frac{\abs{g - \mathhat{g}}^2}{2 \abs{g} \abs{\mathhat{g}}}%
		\label{eq:bound_for_cos}
	\end{align}
	in \cref{eq:exact_expression_for_cosh_of_rhs} gives us
	\begin{align}
		\cosh'{d(h, \mathhat{h})} \leq{}&
		\cosh'{\abs{g}} \cosh'{\abs{\mathhat{g}}} - \sinh'{\abs{g}} \sinh'{\abs{\mathhat{g}}} \left( 1 - \frac{\abs{g - \mathhat{g}}^2}{2 \abs{g} \abs{\mathhat{g}}} \right) \\
		={}& \cosh'{(\abs{g} - \abs{\mathhat{g}})} + \sinh'{\abs{g}} \sinh'{\abs{\mathhat{g}}} \frac{\abs{g - \mathhat{g}}^2}{2 \abs{g} \abs{\mathhat{g}}}\\
		&\{\textrm{inverse triangle inequality}\}\nonumber\\
		\leq{}& \cosh'{(\abs{g - \mathhat{g}})} + \sinh'{\abs{g}} \sinh'{\abs{\mathhat{g}}} \frac{\abs{g - \mathhat{g}}^2}{2 \abs{g} \abs{\mathhat{g}}},%
		\label{eq:where_we_used_inverse_triangle_inequality}
	\end{align}
	and so
	\begin{align}
		1 + 2 \sinh'^2{\frac{d(h, \mathhat{h})}{2}} \leq{}& 1 + 2 \sinh'^2{\frac{\abs{g - \mathhat{g}}}{2}} + \sinh'{\abs{g}} \sinh'{\abs{\mathhat{g}}} \frac{\abs{g - \mathhat{g}}^2}{2 \abs{g} \abs{\mathhat{g}}}%
		\label{eq:where_we_used_cosh_double_angle_formula}\\
		%
		d(h, \mathhat{h}) \leq{}& \frac{2}{\sqrt{\abs{H}}} \operatorname{arcsinh} \sqrt{
			\sinh'^2{\frac{\abs{g - \mathhat{g}}}{2}} + \sinh'{\abs{g}} \sinh'{\abs{\mathhat{g}}} \frac{\abs{g - \mathhat{g}}^2}{4 \abs{g} \abs{\mathhat{g}}}
			}%
	\end{align}
	Noting that $\frac{\sinh{x}}{x}$ is increasing on $\reals^+$, we have that
	\begin{align}
		d(h, \mathhat{h}) \leq{}& \frac{2}{\sqrt{\abs{H}}}  \operatorname{arcsinh} \sqrt{
			\sinh'^2{\frac{\epsilon}{2}} + \frac{\epsilon^2}{4} \cdot \frac{\sinh'^2{\sigma}}{\sigma^2}
			}.
	\end{align}
	Concave functions are subadditive: for example $\sqrt{x^2 + y^2} \leq x + y$ for positive $x$ and $y$, so
	\begin{align}
		d(h, \mathhat{h}) \leq{}& \frac{2}{\sqrt{\abs{H}}} \operatorname{arcsinh} \left(
			\sinh'{\frac{\epsilon}{2}} + \frac{\epsilon}{2} \cdot \frac{\sinh'{\sigma}}{\sigma}
			\right)%
		\label{eq:where_we_used_subadditivity}\\
		%
		&\{\text{$\operatorname{arcsinh}$ is also concave}\}\\
		%
		\leq{}& \epsilon + \frac{2}{\sqrt{\abs{H}}} \operatorname{arcsinh} \left(
			\frac{\epsilon}{2} \cdot \frac{\sinh'{\sigma}}{\sigma}
			\right).%
		\label{eq:end_of_proof}
	\end{align}
\end{proof}

When $H \to 0^-$, \cref{eq:negative_curvature_error_bound} tends to
\begin{align}
	d(h, \mathhat{h}) \leq 2 \epsilon,
\end{align}
which shows that it is an imperfect bound.
To explain why, first note that \cref{eq:bound_for_cos} is an equality when $\abs{g} = \abs{\mathhat{g}}$, but we also used the inverse triangle inequality in \cref{eq:where_we_used_inverse_triangle_inequality} which is an equality when $g$ and $\mathhat{g}$ are colinear.
Furthermore, in \cref{eq:where_we_used_subadditivity} we used subadditivity for the square root, which is only an equality when one of the terms is $0$.
But for small curvatures and small $\epsilon$, the two terms in \cref{eq:where_we_used_subadditivity} are approximately equal.
One could say that we lost a factor $\sqrt{2}$ in each of these steps.

In some regions, \cref{eq:negative_curvature_error_bound} gives a terrible bound for the error on the manifold.
For example, such innocent looking input as $H = -10$, $\sigma = 10$, $\epsilon = \num{1e-12}$ give an error bound of $\approx 0.7$ for $\mathhat{f}$.
In general, if we want \cref{eq:negative_curvature_error_bound} to give a small error, we should have $\sigma < \frac{1}{\sqrt{\abs{H}}}$.

Even though the bound \cref{eq:negative_curvature_error_bound} is imperfect, there is, in the following sense, no bound with better properties.
\begin{proposition}
Let $M$ be a manifold of constant negative curvature $H$ and let $\mathhat{g}$ be an approximation to $g$ such that the maximum error $\epsilon$ is attained at a point $x \in S$ such that $\abs{\mathhat{g}(x)} = \abs{g(x)} = \sigma$, then
	\begin{align}
		d_M(f(x), \mathhat{f}(x)) =
			\frac{2}{\sqrt{\abs{H}}}
			\operatorname{arcsinh}\left(
				\frac{\epsilon}{2} \cdot \frac{\sinh{\sqrt{\abs{H}} \sigma}}{\sigma}
				\right).
	\end{align}
\end{proposition}

\begin{proof}
	If $\abs{g} = \abs{\mathhat{g}}$, then \cref{eq:bound_for_cos} is an equality.
	We then do not need to use the inverse triangle inequality in \cref{eq:where_we_used_inverse_triangle_inequality}, and so \cref{eq:where_we_used_cosh_double_angle_formula} reduces to
	\begin{align}
		1 + 2 \sinh'^2{\frac{d(f, \mathhat{f})}{2}} ={}& 1 + 2 \sinh'^2{\sigma^2} \cdot \frac{\epsilon^2}{2 \sigma^2},\\
		d(f, \mathhat{f}) ={}& \frac{2}{\sqrt{\abs{H}}} \operatorname{arcsinh}{ \left(
			\sinh'^2{\sigma} \cdot \frac{\epsilon}{2 \sigma}
			\right) }.
	\end{align}
	
\end{proof}


\end{document}
